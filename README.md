## hiklink项目

客户端用tcp协议发信息，服务端接收到信息后利用udp进行广播，客户端收到可以接收信息的信号后，对数据进行解析。因为用户不多，所以服务器利用链表的方式维护每一个socket

因为聊天窗口分为左侧联系人项和右侧聊天窗口项，每次打开聊天窗口的时候需要等到两个子窗口初始化完成后才能执行下一步操作，所以程序会很卡，速度很慢。我在第一次优化的时候，增加一个子线程，这个子线程采用并行的方式同时执行左侧和右侧窗口的初始化，后面发现程序的速度并没有提高多少，原因是子线程采用并行的方式，此时主线程是阻塞状态，主线程要等到子线程执行完之后再继续执行。最后进一步优化时，采用异步机制，让子线程在完成构造后，给主线程发送一个信号，主线程收到信号后立即开始执行，没有必要等到子线程完全执行完毕。

本项目采用单例设计模式和中介者设计模式，使用单例设计模式确保只有一个相同的用户能够登录，实现方法和原理：在我的项目中，有一个窗口管理WindowManager类，我定义了一个静态的方法获取这个类的实例，如果这个实例已经存在，就直接返回；否则就创建一个新的实例并返回，**懒加载 vs 饿加载**：我采用懒加载的模式创建单例，因为这个项目只涉及到主线程和一个子线程，这样可以节省资源，提高程序执行速度。在我的项目中，服务端充当中介者，客户端利用tcp的方式给服务器发送信息，服务端利用udp的方式将消息广播给其他客户端，任何其他客户端接收信息

数据库使用JOIN多表嵌套查询：因为我需要利用根据员工表的员工ID去查找部门表中员工ID所对应的公司群的名称，所以我必须在员工表和部门表中使用JOIN嵌套查询，SELECT tab_employees.employeeID, tab_department.department_name FROM tab_employees JOIN tab_department ON tab_employees.departmentID = tab_department.departmentID;

重写鼠标事件：因为在鼠标左键按下并移动时，需要让窗口跟随鼠标移动，所以我重写了鼠标按下，松开以及移动事件，当鼠标按下时，按下事件捕获当前鼠标按下的坐标并把m_mousePress设置为true，鼠标移动时计算当前移动的坐标，然后调用move()函数移动窗口，鼠标松开时，m_mousePress设置为false，窗口停止移动

设计数据包格式：客户端在发送发送文本，表情和文件时分别进行处理，文本数据包格式为"群聊标志+发信息员工QQ号+收信息员工QQ号(群QQ号)+信息类型(1)+数据长度+文本数据"，表情格式为："群聊标志+发信息员工QQ号+收信息员工QQ号(群QQ号)+信息类型(0)+表情个数+images+表情名称"，文件格式为："群聊标志+发信息员工QQ号+收信息员工QQ号(群QQ号)+信息类型(2)+文件字节数+bytes+文件名+data_begin+文件数据"，这里数据长度我设置为5位长，相当于一次可以发送1万以上个字符数据。服务端和客户端在接收数据时，就按照这个格式来拆解

服务器实时显示数据库动态数据：设置计时器，每次触发更新数据库，定时器间隔时间为200ms，时间到后触发一个信号，连接信号与槽，响应槽函数去刷新服务器的表格数据，这里还有个问题就是，如果查询某个员工的数据，更新数据库函数如果不带参，会默认查询所有，导致这个员工的数据显示一瞬间就消失，又显示全部数据了，因为定时器每200ms刷新一次。解决方法是在更新数据库函数中选择传入一个部门或者员工ID的参数，函数体中对所传的参数进行筛选，去更新数据库到界面上。

#### 你可以详细介绍一下项目的整体架构吗？单例设计模式和中介者模式是如何应用的？

整体架构：该项目是一个仿海康内部的通讯工具，采用了C/S架构，在这个架构下，客户端和服务器分别承担不同的角色，客户端负责与用户的交互，提供用户界面，并通过TCP/UDP协议与服务器进行通讯。服务端则负责接收客户端的请求，处理消息的转发和数据库的操作。单例设计模式：客户端设计了一个窗口管理类，采用单例模式，以确保每个账号对应唯一一个客户端实例，这样能够有效管理客户端窗口，避免了重复创建实例的开销。中介者模式：在整个项目中，服务器充当中介者的角色，负责消息的处理和转发，这种中介者模式使得服务器能够集中处理各种客户端的请求，保证了通讯的高效性和可靠性

#### 除了多线程方面异步机制的性能优化，还有没有其他的优化措施？

我把界面元素利用Qt的缓存机制去缓存起来（QPixmap和QImage的使用），以减少重复渲染的开销，提高界面的响应速度和流畅性

#### 在客户端界面设计中，你是如何使用QSS进行美化的？有没有遇到过性能上的挑战？如何解决的？

在客户端中，我用QSS设计界面的颜色和控件的样式；有遇到过，我尽量减少复杂的QSS样式，让界面初始化的负担变小，我还把多个控件写到一个样式表中，减少样式表文件的加载次数。

#### 你为什么选择了TCP和UDP协议？在实际开发中，你是如何处理数据包的格式设计和解析的？对于文件传输有什么考虑？

在客户端和服务器的通讯中，我选择的是TCP协议，这样可以确保客户端和服务器之间消息的可靠传输和稳定连接。在服务器进行广播时，我选择的是UDP协议，因为这样可以提高消息传输的效率和实时性。对于文件传输的话，我主要是利用Qt的文件读写的封装，客户端点击发送文件时，把要发送的文件用字符串读取出来，然后把数据发送到服务端进行广播，客户端接收到文件数据之后，把数据写入到文件路径中。

#### 你可以谈谈数据库部分的设计吗？如何进行多表嵌套查询？有没有遇到过性能问题？如何进行优化的？

在数据库部分我设计了3张表，一张是账号表，一张是部门表，一张是员工表；账号表有员工ID，账号以及密码3个字段，账号是主键；部门表有部门ID，部门名称，部门图片和部门标签4个字段，部门ID是主键；员工表有部门ID，员工ID，员工名称，标签以及一些在线状态，这张表员工ID是主键；嵌套查询主要是利用JOIN	ON语句，因为我要利用员工ID查询部门名称，所以我在部门表和员工表中使用了嵌套查询。SELECT	tab_employees.employeeID,tab_department.departmentID	FROM	tab_employees	JOIN	tab_department	ON	tab_employees.departmentID	=	tab_department.department;	有，因为我经常要通过员工ID查询一些数据，所以我给employeeID创建了索引，这样可以加快查询速度

#### 你是如何使用多线程提升客户端界面的流畅性的？在性能优化方面有没有遇到过挑战？有什么具体的优化措施？

因为聊天窗口分为左侧联系人项和右侧聊天窗口项，每次打开聊天窗口的时候要需要等到两个子窗口初始化完成才会执行下一步操作，所以程序会很卡，速度很慢，所以我在第一次项目优化的时候，考虑给聊天窗口增加一个子线程，这个子线程采用并行的方式同时执行左侧和右侧窗口的初始化，后面发现程序的速度并没有提升多少，原因是子线程执行时，主线程是阻塞状态，主线程要等到子线程执行完成之后才会执行下一步操作。后面再一次优化的时候，采用异步机制，当子线程构造完成后，采用信号与槽机制，给主线程发送一个信号，主线程收到信号后，立马开始执行下一步操作，没有必要等到子线程执行完毕。**如何确保异步操作的安全性和可靠性：**采用信号与槽机制，确保主线程和异步线程之间进行安全的数据传输

#### 在项目中你是如何使用git进行版本控制的？是否遇到过团队协作的挑战？如何解决的？

我先在本地创建一个hinklink的本地仓库，然后定期的把源码用git push的方式把它推送到远程仓库GitHub上

#### 你在项目中提到了一些难点，比如TCP/UDP通信、数据包格式设计等，可以详细讲讲你是如何解决这些问题的吗？

TCP/UDP通讯是利用socket编程，服务端和客户端分别创建一个socket对象，服务器通过bind()绑定ip地址和端口，然后开始通过listen进行监听，客户端发送请求时，服务端接受请求并进行数据传输，数据传输完毕后关闭；客户端建立连接数据传输后，关闭连接。

设计数据包格式：客户端在发送发送文本，表情和文件时分别进行处理，文本数据包格式为"群聊标志+发信息员工QQ号+收信息员工QQ号(群QQ号)+信息类型(1)+数据长度+文本数据"，表情格式为："群聊标志+发信息员工QQ号+收信息员工QQ号(群QQ号)+信息类型(0)+表情个数+images+表情名称"，文件格式为："群聊标志+发信息员工QQ号+收信息员工QQ号(群QQ号)+信息类型(2)+文件字节数+bytes+文件名+data_begin+文件数据"，这里数据长度我设置为5位长，相当于一次可以发送1万以上个字符数据。服务端和客户端在接收数据时，就按照这个格式来拆解

#### 项目完成后，你觉得自己取得了哪些成果？有没有什么可以改进的地方？

我完成了项目功能的实现，自己的编程水平得到了提高，对qt框架和网络编程也有了更好的理解。通过git的使用，我学会了更好的管理和组织项目代码，提高了效率。这个项目还要进行一些功能的完善，我想在这个项目的基础上，再增加视频通话的功能，现在还在完善中。
